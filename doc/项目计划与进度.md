# **宝可梦豫都地区 MUD AI 代理系统 - 项目计划与进度**

**最后更新:** 2025年5月13日

## **项目概述**

"豫都地区" 是一个基于 Pokémon 世界观的原创区域，本项目旨在创建一个多用户文字冒险游戏 (MUD)，让玩家能够在这个虚构的区域中探索、捕捉宝可梦、与训练家对战，并体验独特的冒险故事。

## **阶段划分与进度**

### **一、项目准备与设计阶段 ✅**

-   [x] 确定项目范围与核心玩法
-   [x] 选择技术栈：Next.js + TypeScript + Tailwind CSS
-   [x] 项目结构设计
-   [x] 文字冒险系统框架设计
-   [x] 初步确定数据结构

### **二、数据准备阶段 ✅**

-   [x] 创建豫都地区宝可梦图鉴数据
-   [x] 准备技能、特性数据
-   [x] 准备地点、NPC 数据
-   [x] 设计初始剧情与任务体系
-   [x] 数据加载与处理功能实现

### **三、核心功能实现阶段 🔄**

-   [ ] 实现基础游戏状态管理
-   [ ] 地点系统与移动功能
-   [ ] NPC 对话系统
-   [ ] 宝可梦捕捉系统
-   [ ] 战斗系统
-   [x] 数据加载模块
    -   [x] 创建 gameData.ts 用于加载和缓存游戏数据
    -   [x] 实现宝可梦图鉴数据加载
    -   [x] 实现招式数据加载
    -   [x] 实现特性数据加载
    -   [x] 完成数据加载路径优化，确保在不同环境下都能正确加载数据
-   [ ] 道具和背包系统
-   [ ] 存档与读档功能
-   [ ] **地图系统 (后端):**
    -   [ ] 创建 `src/lib/mapUtils.ts` 并实现核心地图生成逻辑 (`generateLocationMap`, `generateAreaMap`)
    -   [ ] 修改游戏 API (`game/route.ts`) 以在玩家移动时自动提供当前位置地图数据
    -   [ ] 创建新的 API 端点 (`api/map/route.ts`) 以支持 'map' 命令

### **四、前端界面开发阶段 🔄**

-   [x] 基本页面布局设计
-   [x] 创建游戏主页面
    -   [x] 添加游戏标题和简介
    -   [x] 实现数据加载测试功能
-   [ ] 文字冒险界面
-   [ ] 交互命令解析器
-   [ ] 战斗界面
-   [ ] 宝可梦状态查看界面
-   [ ] 背包界面
-   [ ] **地图界面与显示:**
    -   [ ] 实现地图信息在主游戏界面的自动显示 (玩家进入新区域时)
    -   [ ] 实现通过 'map' 命令显式查看区域地图或当前位置地图的功能
-   [ ] 地图界面

### **五、多用户功能开发阶段 ⏳**

-   [ ] 用户注册与登录
-   [ ] 多用户状态管理
-   [ ] 用户交互功能 (交易、对战)
-   [ ] 聊天系统

### **六、测试与优化阶段 ⏳**

-   [ ] 单元测试
-   [ ] 集成测试
-   [ ] 用户体验优化
-   [ ] 性能优化

### **七、部署与运维阶段 ✅**

-   [x] 部署到生产环境 (已在 Vercel 初步部署)
-   [ ] 监控系统搭建
-   [ ] 持续集成与部署流程

### **八、内容扩展阶段 ⏳**

-   [ ] 扩展地图与地点
-   [ ] 增加新的剧情与任务
-   [ ] 增加宝可梦与道具

## **具体任务分解**

### **当前工作重点**

1.  **完善核心游戏循环 (NPC 交互、宝可梦系统基础、物品系统基础)**
2.  **开发基础用户界面 (文字冒险界面、命令输入输出)**
3.  **集成初步的 AI 对话功能 (NPC)**

### **下一步工作计划**

1.  **NPC 系统：** 实现 NPC 数据加载、与地点关联、`talk to <NPC>` 命令对接 AI 服务。
2.  **宝可梦系统：** 实现宝可梦实例数据结构、图鉴系统。
3.  **物品系统：** 实现物品数据加载、`inventory`、`get`/`take`、`drop` 命令。
4.  **前端界面：** 搭建基本的文字冒险交互界面，处理命令输入和游戏状态显示。

## **风险与挑战**

1. 文字冒险游戏的用户体验设计
2. 多用户并发状态管理的复杂性
3. 宝可梦战斗系统的平衡性
4. 性能优化，特别是在用户数量增加时

## **资源与依赖**

1. 宝可梦数据 - 基于自创数据
2. 技术依赖：
    - Next.js: 前端框架
    - TypeScript: 类型安全
    - Tailwind CSS: 样式系统
    - Vercel: 部署平台
    - 数据库待定 (考虑 Vercel KV 或 Postgres)

## **阶段 0: 项目设置与基础架构 (Setup & Foundation)**

**已确认技术栈:**
*   **前端:** Next.js (React)
*   **UI 库:** Tailwind CSS (初步选择)
*   **后端 (API):** Node.js + TypeScript (部署为 Vercel Serverless Functions)
*   **AI 服务:** Grok (或其他兼容 API)
*   **数据库:** Vercel KV / Vercel Postgres (待定)

-   [x] **技术选型确认:**
    -   [x] 前端框架 (Next.js / SvelteKit)
    -   [x] 后端语言/框架 (Node.js + TypeScript/JavaScript on Vercel)
    -   [x] 数据库 (Vercel KV / Postgres / Supabase / PlanetScale / MongoDB Atlas)
    -   [x] AI 服务 (OpenAI / Anthropic Claude / Grok)
-   [x] **项目初始化:**
    -   [x] 创建 Git 代码仓库
    -   [x] 初始化前端项目
    -   [x] 初始化后端项目 (Vercel Serverless Functions 结构)
-   [x] **基础数据准备:**
    -   [x] 整理并校验所有静态 JSON 数据 (`locations`, `pokedex`, `pokemon_location`, `items`, `npcs`, `moves`, `abilities`) -> (仅加载了 pokedex, moves, abilities 汇总文件)
    -   [x] 实现后端静态数据加载逻辑 -> (已编写加载代码，并测试通过)
-   [x] **数据库 Schema 定义:**
    -   [x] 定义玩家数据结构 (基础信息, 队伍, 物品栏, 图鉴, 任务标志, 信用状态, 关系标志等)
    -   [x] 定义宝可梦详细状态结构 (用于玩家队伍和存储)

## **阶段 1: 核心游戏循环 - Part 1 (世界与移动系统)**

*   [x] **定义世界数据结构 (`locations.json`)** (由其他 AI 细化)
*   [x] **加载世界数据 (`gameData.ts`, `worldManager.ts`)**
*   [x] **实现基本的玩家移动命令 (`go <方向>`, `<方向>`, `enter`, `out` 等)** (已修复 `game.ts` 逻辑)
*   [x] **实现 `look`/`l`/`examine`/`ex` 命令显示地点/目标信息** (已在 `game.ts` 中合并实现)
*   [ ] (可选) 实现简单的 NPC 对话触发机制 (基于地点?)
*   [ ] (可选) 实现简单的物品交互 (`get`/`drop` 基础)

--(阶段 1 核心完成)--

## **阶段 2: 核心游戏循环 - Part 2 (宝可梦、物品、基础 NPC)**

-   [ ] **宝可梦系统 (基础):**
    -   [ ] 实现宝可梦实例数据结构 (区分静态图鉴数据与个体状态: 等级, HP, 招式等)
    -   [ ] 实现宝可梦核心属性和战斗属性表示
    -   [x] 实现玩家宝可梦队伍管理 (`pokemon`/`team` 命令查看)
    -   [ ] 实现图鉴系统 (`pokedex` 命令查看，追踪遇见/捕捉状态)
    -   [ ] 实现返祖化 (Atavism) 概念标记 (具体机制待后续)
-   [ ] **物品系统:**
    -   [ ] 实现物品数据加载 (`items.json`)
    -   [ ] 实现物品效果定义 (基础效果)
    -   [ ] 实现 `inventory`/`inv`/`i` 命令
    -   [ ] 实现 `get`/`take` 命令
    -   [ ] 实现 `drop` 命令
    -   [ ] 实现 `use <物品>` 命令 (基础消耗品)
-   [ ] **NPC 系统 (基础 - AI 驱动):**
    *   [ ] 定义 NPC 数据结构 (`npcs.json` + Prompt 文件) (已创建接口和示例文件)
    *   [ ] 实现 NPC 数据加载逻辑 (合并 `npcs.json` 和 Prompt 文件)
    *   [ ] 在 `WorldManager` 中关联 NPC 到地点
    *   [ ] 修改 `look`/`examine` 命令以显示 NPC
    *   [ ] 实现 `talk to <NPC>` 命令 (调用 AI 服务)
    *   [ ] (可选) 实现 `ask <NPC> about <话题>` (通过 AI 处理)

## **阶段 3: 核心游戏循环 - Part 3 (战斗、捕捉、任务)**

-   [ ] **对战系统 (GBA 启发):**
    -   [ ] 实现战斗发起机制 (`fight <目标>` 或遭遇)
    -   [ ] 实现回合制逻辑 (速度决定顺序)
    -   [ ] 实现玩家战斗选项 (`fight` 选招, `pokemon` 换怪, `item` 用道具, `run` 逃跑)
    -   [ ] 实现招式执行逻辑 (伤害计算, 属性克制, PP 消耗)
    -   [ ] 实现状态异常效果
    -   [ ] 实现特性触发 (基础)
    -   [ ] 实现战斗结束逻辑 (胜负判断, 经验值/金钱结算)
    -   [ ] 实现战斗日志输出
-   [ ] **捕捉系统 (直接互动):**
    -   [ ] 实现 `catch <宝可梦> [with <精灵球>]` 命令 (非战斗)
    -   [ ] 设计并实现捕捉互动机制 (文本描述, 成功率计算)
    -   [ ] 实现精灵球效果
    -   [ ] 实现捕捉失败逻辑 (逃跑/战斗)
-   [ ] **任务/事件系统 (基础):**
    -   [ ] 实现玩家数据中的任务标志 (flags) 系统
    -   [ ] 实现事件触发器 (进入地点, 对话, 战斗胜利等)
    -   [ ] 实现检查和设置任务标志的逻辑
    -   [ ] 实现基于标志的任务效果 (解锁内容/奖励)

## **阶段 4: AI 集成**

*   [x] **通用 AI 设置:** (部分移至 NPC 系统)
    -   [ ] 设计 AI 交互的 Prompt Engineering 策略 (训练 & 对话)
    -   [ ] 实现 AI 服务 API 调用封装 (考虑成本和速率限制)
    -   [ ] 实现后端向前端发送 AI 交互信号的机制
*   [/] **AI 驱动的 NPC 交互:** (主要逻辑在阶段 2 实现)
    *   [ ] 实现准备 NPC 对话上下文 (Prompt, 玩家状态, 对话历史) 并调用 AI 的逻辑
    *   [ ] 实现处理 AI 生成的动态对话 (解析特殊指令 `**give**`, `**fight**` 等)
    *   [ ] (可选) 实现玩家信用状态/关系对 AI 对话的影响

## **阶段 5: 前端开发**

-   [ ] **基础 UI 搭建:**
    -   [ ] 实现游戏主界面布局 (输出区域, 输入行, 状态栏)
    -   [ ] 实现游戏文本输出显示
    -   [ ] 实现命令输入处理
    -   [ ] 实现玩家状态显示 (HP, 队伍概览等)
-   [ ] **后端通信:**
    -   [ ] 实现前端到后端 API 的调用逻辑
    -   [ ] 处理后端返回的游戏状态更新和消息
-   [ ] **UI 增强:**
    -   [ ] 实现 `map` 命令的地图显示 (详细任务见“四、前端界面开发阶段”)
    -   [ ] 实现物品栏和宝可梦队伍的详细查看界面
    -   [ ] 实现 AI 交互的 UI 视觉提示 (根据后端信号改变样式)

## **阶段 6: 部署与测试**

-   [x] **Vercel 部署:** (初步部署完成，待后续完善 CI/CD 和监控)
    -   [x] 配置 Vercel 项目连接 Git 仓库
    -   [x] 部署前端应用
    -   [x] 部署后端 Serverless Functions (`/api`)
    -   [x] 配置环境变量 (API 密钥, 数据库连接字符串)
-   [ ] **数据库集成:**
    -   [ ] 确保后端函数能正确连接和访问 Vercel 数据库
    -   [ ] 处理无服务器环境下的数据库连接管理
-   [ ] **测试:**
    -   [ ] 单元测试 (关键逻辑模块)
    -   [ ] 集成测试 (前后端交互, AI 调用)
    -   [ ] 端到端测试 (模拟玩家完整游戏流程)
    -   [ ] 性能和负载测试 (初步)

## **阶段 7: 文档与完善**

-   [ ] **游戏内文档:**
    -   [ ] 实现 `help` 命令，提供命令列表和基本玩法说明
-   [ ] **项目文档:**
    -   [ ] 更新 `技术文档.md` 以反映最终实现
    -   [ ] 更新 `README.md`，包含项目介绍、设置和启动说明
    -   [ ] 维护 `项目计划与进度.md`
-   [ ] **代码审查与重构:**
    -   [ ] 进行代码审查
    -   [ ] 根据测试反馈和审查意见进行代码重构和优化

## **未来考虑 (Post-MVP)**

-   [ ] 多人游戏支持
-   [ ] 更复杂的 AI 行为
-   [ ] 图形化界面元素
-   [ ] 更复杂的任务系统
-   [ ] 玩家对战 (PvP)
-   [ ] 宝可梦交易系统
-   [ ] 制作系统
-   [ ] 深入的返祖化故事线

---

**进度标记:**

*   `[ ]` - 未开始 (To Do)
*   `[/]` - 进行中 (In Progress)
*   `[x]` - 已完成 (Done)